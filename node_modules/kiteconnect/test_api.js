var KiteConnect = require("./lib").KiteConnect;

var kc = new KiteConnect("50avzx9yjuactznl");

var m = {"order_id":"170310000493556","exchange_order_id":"131706900077702","gui_order_id":"beii77d5kq","order_timestamp":"2017-03-10 16:36:52","exchange_timestamp":"10-Mar-2017 16:26:32","status":"COMPLETE","status_message":"","source":"COMAPIA","account_id":"PS1421","user_id":"PS1421","tradingsymbol":"CRUDEOIL17MARFUT","exchange":"MCX","transaction_type":"SELL","order_type":"LIMIT","quantity":100,"filled_quantity":100,"unfilled_quantity":0,"price":3306,"average_price":3306,"trigger_price":0,"product":"MIS","validity":"DAY","checksum":"bf827d8e8dd6dcb3bfb130472ada7453ab1fe5c6368ddabd929a3be7d8461004"}

console.log(kc.validatePostback(m, "cqayxnx0ubxdk0nd6wd8tjmbp19jwkc1"))

var accessToken = "ia3b8bi7hv9ftn06evrmmd7fqar54t2d"

if (!accessToken) {
	kc.requestAccessToken("fyg12t58ffh11unplhx66ea1fa9154od", "cqayxnx0ubxdk0nd6wd8tjmbp19jwkc1")
		.then(function(response) {
			console.log("response", response)
			init();
		})
		.catch(function(err) {
			console.log(err.response);
		})
} else {
	kc.setAccessToken(accessToken)
	init()
}

function init() {
    // Fetch equity margins.
    // You can have other api calls here.
	kc.margins("equity").then(function(resp) {
		console.log("resp", resp)
	}).catch(function(err) {
		console.log("err", err);
	})

    kc.historical(1270529, "2017-03-05", "2017-03-12", "minute")
        .then(function(response) {
			console.log("historical", response)
            // You got user's margin details.
        }).catch(function(err) {
			console.log("error", err.error)
            // Something went wrong.
        });
}